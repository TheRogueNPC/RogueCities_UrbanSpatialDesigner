# RogueCities AI Agent Contract

This document serves as the absolute ground truth for any Artificial Intelligence Agent, LLM, or Copilot interacting with the RogueCities_UrbanSpatialDesigner codebase. 

By executing commands or modifying files within this workspace, you (the AI) implicitly agree to all terms and conditions outlined below. 

## 1. Prime Directives

1.  **Do No Harm**: You shall not silently delete compatability pathways, break existing features without user consent, or restructure core components without explicit architectural approval.
2.  **Strict Layer Compliance**: You shall honor the boundaries defined in `GEMINI.md`. (e.g., No UI code inside `core/` or `generators/`).
3.  **Determinism Above All**: All generation algorithms and procedural systems must remain perfectly reproducible via fixed random seeds. Do not introduce non-deterministic threading side-effects.

## 2. Environment Mandate

You are operating within a highly customized CMake + C++ environment.

*   **You MUST use the Dev Shell**: Do not attempt to run naked `cmake` or `ctest` commands. Always source or execute `tools/dev-shell.ps1` first, or utilize the provided aliases (`rc-bld-core`, `rc-cfg`, `rc-watch`).
*   **The Dev Shell is Truth**: The Dev Shell dynamically configures the correct paths for CMake, Miniconda, Vcpkg, and Python. Bypassing it guarantees compilation failure.

## 3. The Telemetry Bridge (Diagnostics)

Do not waste the developer's time asking them to "copy and paste the error output." You have direct access to automated diagnostic artifacts.

### 3.1 Resolving Compile Errors
If the developer states a build failed:
1.  Read `.vscode/problems.export.json` if available.
2.  Alternatively, invoke the `rc-problems` command via PowerShell to get a summarized map of the errors.

### 3.2 Resolving Run-Time Crashes
If the developer states the application crashed or violated an assertion:
1.  **Immediately** read `AI/diagnostics/runtime_crash.json`.
2.  This file is automatically generated by `RogueCity::Core::Validation::AiTelemetry` moments before `std::abort()`. It contains the exact file, line number, module, and state context of the failure.

## 4. Architectural Workflows

When implementing a new feature, you must adhere to the documented templates and schemas:

*   **UI Features**: Always consult `visualizer_architecture_ki.md` and complete the `ui_plan_template.md` before writing a single line of ImGui code.
*   **Generators**: Ensure any new generator adheres strictly to the staged-cache pipeline and utilizes `Boost::Geometry` for spatial mathematics. Do not write custom geometric overlap functions.

## 5. Continuous Improvement

*   **Audit First**: Before refactoring a file, verify if a Knowledge Item (KI) or an audit pass (e.g., Noether Symmetry Audit) has already outlined the required strategy.
*   **Update the Changelog**: Every tangible modification must be recorded proactively and concisely in `CHANGELOG.md` without prompting.

---
*End of Contract. Acknowledge and proceed.*
